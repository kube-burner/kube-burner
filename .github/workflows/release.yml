name: Release Workflow
on:
  push:
    tags:
      - "*" # triggers only if push new tag version
jobs:
  ci-tests:
    uses: ./.github/workflows/ci-tests.yml
    secrets: inherit

  ci-k8s-tests:
    uses: ./.github/workflows/ci-k8s-tests.yml
    needs: ci-tests
    secrets: inherit

  release-build:
    uses: ./.github/workflows/gorelease.yml
    needs:
      - ci-tests
      - ci-k8s-tests

  image-upload:
    uses: ./.github/workflows/image-upload.yml
    needs:
      - ci-tests
      - ci-k8s-tests
    secrets: inherit

  deploy-docs:
    uses: ./.github/workflows/docs.yml
    needs: ci-tests
