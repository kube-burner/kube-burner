# CLI

kube-burner is tool written in golang that can be used to stress kubernetes clusters by creating, deleting and patching resources at a
given rate. The actions taken by this tool are highly custimizable, and their available subcommands are detailed below:

```console
$ kube-burner help
Kube-burner ðŸ”¥

Tool aimed at stressing a kubernetes cluster by creating or deleting lots of objects.

Usage:
  kube-burner [command]

Available Commands:
  check-alerts Evaluate alerts for the given time range
  completion   Generates completion scripts for bash shell
  destroy      Destroy old namespaces labeled with the given UUID.
  help         Help about any command
  import       Import metrics tarball
  index        Index kube-burner metrics
  init         Launch benchmark
  version      Print the version number of kube-burner

Flags:
  -h, --help   help for kube-burner
  --log-level string   Allowed values: debug, info, warn, error, fatal (default "info")

Use "kube-burner [command] --help" for more information about a command.
```

## Init

This is the main subcommand, it triggers a new kube-burner benchmark and it supports the these flags:

- uuid: Benchmark ID. This is esentially an arbitrary string that is used for different purposes along the benchmark. For example, label the objects created by kube-burner as mentioned in the [configuration chapter](/kube-burner/configuration/#default-labels). By default is autogenerated. You can generate a new uuid in linux with the commands `uuidgen` or `cat /proc/sys/kernel/random/uuid`.
- config: Path or URL to a valid configuration file. Details abou the configuration can be found in the [configuration chapter of the docs](/kube-burner/configuration/)
- configmap: Name of the Configmap holding all the configuration: config.yml, metrics.yml and alerts.yml. metrics and alerts are optional
- namespace: Name of namespace where the configmap is.
- log-level: Logging level. Default `info`, error, debug and fatal are also accepted.
- prometheus-url: Prometheus full URL. i.e. `https://prometheus-k8s-openshift-monitoring.apps.rsevilla.stress.mycluster.example.com`
- metrics-profile: Path to a valid metrics profile file. Default `metrics.yaml`
- metrics-endpoint: Path to a valid metrics endpoint file.
- token: Prometheus Bearer token.
- username: Prometheus username for basic authentication.
- password: Prometheus password for basic authentication.
- skip-tls-verify: Skip TLS verification for prometheus. Default `true`
- step: Prometheus step size. Default `30s`
- timeout: Kube-burner benchmark global timeout. When timing out, return code is 2. Default `4h`
- user-metadata: YAML file path containing custom user-metadata to be indexed.

**Note**: Both basic authentication and Bearer authentication need credentials able to query the given Prometheus API.

With the above, triggering kube-burner would be as simple as:

```console
kube-burner init -c cfg.yml -u https://prometheus-k8s-openshift-monitoring.apps.rsevilla.stress.mycluster.example.com -t ${token} --uuid 67f9ec6d-6a9e-46b6-a3bb-065cde988790`
```

Kube-burner also supports remote configuration files served by a web server, to use it, rather than a path pass a URL like below:

```console
kube-burner init -c http://web.domain.com:8080/cfg.yml -t ${token} --uuid 67f9ec6d-6a9e-46b6-a3bb-065cde988790`
```

If you have no interest in collecting prometheus metrics, kube-burner can also be launched w/o any prometheus reference to disable metrics collection.

```console
kube-burner init -c cfg.yml --uuid 67f9ec6d-6a9e-46b6-a3bb-065cde988790`
```

To scrape metrics from multiple endpoints init command can be triggered as below.

```console
kube-burner init -c cluster-density.yml -e metrics-endpoints.yaml
```

And a metrics-endpoints.yaml file with valid keys for the `init` command would look something like this.

```yaml
- endpoint: http://localhost:9090
  token: <token>
  profile: metrics.yaml
  alertProfile: alert-profile.yaml
- endpoint: http://remotehost:9090
  token: <token>
```

Note: Options `profile`, `alertProfile` are optional. If not provided will be taken from the CLI flags first or else will be populated with the default values. And also apart from valid keys rest all will be ignored.

## Index

This subcommand can be used to collect and index the metrics from a given time range. The time range is given by:

- start: Epoch start time. Defaults to one hour before the current time.
- end: Epoch end time. Defaults to the current time.

## Check alerts

This subcommand can be used to evaluate alerts configured in the given alert profile. Similar to `index` the time range is given by the start and end flags.

## Destroy

This subcommand requires the above `uuid` flags to destroy all namespaces labeled with `kube-burner-uuid=<UUID>`.

## Completion

Generates bash a completion script that can be imported with:
`. <(kube-burner completion)`

Or permanently imported with:
`kube-burner completion > /etc/bash_completion.d/kube-burner`
