# CLI

kube-burner is a tool written in golang that can be used to stress kubernetes clusters by creating, deleting and patching resources at a
given rate. The actions taken by this tool are highly customizable and their available subcommands are detailed below:

```console
$ kube-burner help
Kube-burner ðŸ”¥

Tool aimed at stressing a kubernetes cluster by creating or deleting lots of objects.

Usage:
  kube-burner [command]

Available Commands:
  check-alerts Evaluate alerts for the given time range
  completion   Generates completion scripts for bash shell
  destroy      Destroy old namespaces labeled with the given UUID.
  help         Help about any command
  import       Import metrics tarball
  index        Index kube-burner metrics
  init         Launch benchmark
  version      Print the version number of kube-burner

Flags:
  -h, --help   help for kube-burner
  --log-level string   Allowed values: debug, info, warn, error, fatal (default "info")

Use "kube-burner [command] --help" for more information about a command.
```

## Init

This is the main subcommand, it triggers a new kube-burner benchmark and it supports the these flags:

- `uuid`: Benchmark ID. This is esentially an arbitrary string that is used for different purposes along the benchmark. For example, label the objects created by kube-burner as mentioned in the [reference chapter](/kube-burner/configuration/#default-labels). By default is autogenerated.
- `config`: Path or URL to a valid configuration file. Details about configuration schema in the [reference chapter](/kube-burner/configuration/).
- `configmap`: In case of not providing the `--config` flag, kube-burner is able to fetch its configuration from a given `configMap`, this variable configures its name, kube-burner expects the configMap to hold all the required configuration: config.yml, metrics.yml and alerts.yml. Where metrics.yml and alerts.yml are optional.
- `namespace`: Name of namespace where the configmap is.
- `log-level`: Logging level, one of: `debug`, `error`, `info` or `fatal`. Default `info`.
- `prometheus-url`: Prometheus endpoint, required for metrics collection. i.e. `https://prometheus-k8s-openshift-monitoring.apps.rsevilla.stress.mycluster.example.com`
- `metrics-profile`: Path to a valid metrics profile file. Default `metrics.yml`
- `metrics-endpoint`: Path to a valid metrics endpoint file.
- `token`: Prometheus Bearer token.
- `username`: Prometheus username for basic authentication.
- `password`: Prometheus password for basic authentication.
- `skip-tls-verify`: Skip TLS verification for prometheus. Default `true`
- `step`: Prometheus step size. Default `30s`
- `timeout`: Kube-burner benchmark global timeout. When timing out, return code is 2. Default `4h`
- `user-metadata`: YAML file path containing custom user-metadata to be indexed.

!!! Note "Prometheus authentication"
    Both basic and token authentication methods need permissions able to query the given Prometheus endpoint.

With the above, running a kube-burner benchmark would be as simple as:

```console
kube-burner init -c cfg.yml -u https://prometheus-k8s-openshift-monitoring.apps.rsevilla.stress.mycluster.example.com -t ${token} --uuid 67f9ec6d-6a9e-46b6-a3bb-065cde988790`
```

Kube-burner also supports remote configuration files served by a web server, to use it, rather than a path pass a URL like below:

```console
kube-burner init -c http://web.domain.com:8080/cfg.yml -t ${token} --uuid 67f9ec6d-6a9e-46b6-a3bb-065cde988790`
```

To scrape metrics from multiple endpoints init command can be triggered as below.

```console
kube-burner init -c cluster-density.yml -e metrics-endpoints.yaml
```

And a metrics-endpoints.yaml file with valid keys for the `init` command would look something like this.

```yaml
- endpoint: http://localhost:9090
  token: <token>
  profile: metrics.yaml
  alertProfile: alert-profile.yaml
- endpoint: http://remotehost:9090
  token: <token>
```

!!! Note
    Options `profile` and `alertProfile` are optional. If not provided will be taken from the CLI flags first or else will be populated with the default values. And also apart from valid keys rest all will be ignored.

## Index

This subcommand can be used to collect and index the metrics from a given time range. The time range is given by:

- `start`: Epoch start time. Defaults to one hour before the current time.
- `end`: Epoch end time. Defaults to the current time.

## Check alerts

This subcommand can be used to evaluate alerts configured in the given alert profile. Similar to `index` the time range is given by the `start` and `end` flags.

## Destroy

This subcommand requires the `uuid` flag to destroy all namespaces labeled with `kube-burner-uuid=<UUID>`.

## Completion

Generates bash a completion script that can be imported with:
`. <(kube-burner completion)`

Or permanently imported with:
`kube-burner completion > /etc/bash_completion.d/kube-burner`

!!! note
    the `bash-completion` utils must be installed in order to kube-burner's completion to work
